name: ğŸ¤– Excel-Okuyan AI YanÄ±t

on:
  issues:
    types: [opened]
  workflow_dispatch:

jobs:
  excel-ai:
    if: contains(github.event.issue.labels.*.name, 'excel-ai')
    
    runs-on: ubuntu-latest
    
    permissions:
      issues: write
      contents: read
    
    steps:
    - name: ğŸ“¥ Repository'yi Ã§ek
      uses: actions/checkout@v3
      
    - name: ğŸ Python kur
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
      
    - name: ğŸ“¦ KÃ¼tÃ¼phaneleri kur
      run: |
        pip install pandas openpyxl requests
        echo "âœ… KÃ¼tÃ¼phaneler kuruldu"
      
    - name: ğŸ” Excel dosyalarÄ±nÄ± kontrol et
      run: |
        echo "ğŸ“‚ Mevcut dosyalar:"
        ls -la *.xls* || echo "Excel dosyasÄ± yok"
      
    - name: ğŸ¤– Excel AI analizini Ã§alÄ±ÅŸtÄ±r
      env:
        GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      run: python .github/excel_ai_analyzer.py "${{ github.event.issue.body }}"
      
    - name: ğŸ’¬ YanÄ±tÄ± Issue'a ekle
      uses: actions/github-script@v6
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const fs = require('fs');
          let response = "AI yanÄ±tÄ± oluÅŸturulamadÄ±.";
          
          try {
            response = fs.readFileSync('ai_response.txt', 'utf8');
          } catch (e) {
            response = `âš ï¸ Hata: ${e.message}`;
          }
          
          await github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: `## ğŸ“ˆ EXCEL AI ANALÄ°Z RAPORU\n\n${response}\n\n---\nâš¡ **Sistem:** Otomatik Excel Okuyucu AI\nğŸ“… **Analiz Tarihi:** ${new Date().toLocaleString('tr-TR')}\nğŸ¤– **AI Model:** Groq Llama 3.1`
          });
          
          console.log("âœ… Excel AI yanÄ±tÄ± eklendi!");
